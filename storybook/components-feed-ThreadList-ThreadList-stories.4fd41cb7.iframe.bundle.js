"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[546],{"./src/components/feed/ThreadList/ThreadList.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ThreadList_stories});var react=__webpack_require__("./node_modules/react/index.js"),Thread=__webpack_require__("./src/components/feed/Thread/Thread.tsx"),EmptyFeedPlaceholder=__webpack_require__("./src/components/feed/EmptyFeedPlaceholder/EmptyFeedPlaceholder.tsx"),Notification=__webpack_require__("./src/components/feed/Notification/Notification.tsx"),Text=__webpack_require__("./src/components/common/Text/Text.tsx"),utils=__webpack_require__("./node_modules/@tanstack/query-core/build/lib/utils.mjs"),queryObserver=__webpack_require__("./node_modules/@tanstack/query-core/build/lib/queryObserver.mjs"),infiniteQueryBehavior=__webpack_require__("./node_modules/@tanstack/query-core/build/lib/infiniteQueryBehavior.mjs");class InfiniteQueryObserver extends queryObserver.z{constructor(client,options){super(client,options)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(options,notifyOptions){super.setOptions({...options,behavior:(0,infiniteQueryBehavior.Gm)()},notifyOptions)}getOptimisticResult(options){return options.behavior=(0,infiniteQueryBehavior.Gm)(),super.getOptimisticResult(options)}fetchNextPage({pageParam,...options}={}){return this.fetch({...options,meta:{fetchMore:{direction:"forward",pageParam}}})}fetchPreviousPage({pageParam,...options}={}){return this.fetch({...options,meta:{fetchMore:{direction:"backward",pageParam}}})}createResult(query,options){var _state$fetchMeta,_state$fetchMeta$fetc,_state$fetchMeta2,_state$fetchMeta2$fet,_state$data,_state$data2;const{state}=query,result=super.createResult(query,options),{isFetching,isRefetching}=result,isFetchingNextPage=isFetching&&"forward"===(null==(_state$fetchMeta=state.fetchMeta)||null==(_state$fetchMeta$fetc=_state$fetchMeta.fetchMore)?void 0:_state$fetchMeta$fetc.direction),isFetchingPreviousPage=isFetching&&"backward"===(null==(_state$fetchMeta2=state.fetchMeta)||null==(_state$fetchMeta2$fet=_state$fetchMeta2.fetchMore)?void 0:_state$fetchMeta2$fet.direction);return{...result,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:(0,infiniteQueryBehavior.Qy)(options,null==(_state$data=state.data)?void 0:_state$data.pages),hasPreviousPage:(0,infiniteQueryBehavior.ZF)(options,null==(_state$data2=state.data)?void 0:_state$data2.pages),isFetchingNextPage,isFetchingPreviousPage,isRefetching:isRefetching&&!isFetchingNextPage&&!isFetchingPreviousPage}}}var useBaseQuery=__webpack_require__("./node_modules/@tanstack/react-query/build/lib/useBaseQuery.mjs");var apis_http=__webpack_require__("./src/apis/http.ts"),feed=__webpack_require__("./src/constants/feed.ts");var query=__webpack_require__("./src/constants/query.ts");const useFetchThreads=teamPlaceId=>{const{data:threadPages,hasNextPage,fetchNextPage}=function useInfiniteQuery(arg1,arg2,arg3){const options=(0,utils._v)(arg1,arg2,arg3);return(0,useBaseQuery.r)(options,InfiniteQueryObserver)}(["threadData",teamPlaceId],(({pageParam})=>((teamPlaceId,lastThreadId)=>{const query=lastThreadId?`last-thread-id=${lastThreadId}&size=${feed.Yz}`:`size=${feed.Yz}`;return apis_http.d.get(`/api/team-place/${teamPlaceId}/feed/threads?${query}`)})(teamPlaceId,pageParam)),{enabled:teamPlaceId>0,getNextPageParam:lastPage=>{if(!(lastPage.threads.length<feed.Yz))return lastPage.threads[feed.Yz-1].id},staleTime:query.i.TEAM_FEED});return{threadPages,hasNextPage,fetchNextPage}};var useTeamPlace=__webpack_require__("./src/hooks/useTeamPlace.ts"),typeGuard=__webpack_require__("./src/types/typeGuard.ts");const splitDateTime=dateTime=>{const[date,time]=dateTime.split(" ");if(!(0,typeGuard.c)(date))throw Error("잘못된 dateTime 변수가 대입되었습니다.");return{date,time}};const lastThreadText=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js").iv`
  display: flex;
  align-self: center;

  font-weight: 600;
`,formatDate=rawDate=>{const[year,month,day]=rawDate.split("-");return`${year}년 ${month}월 ${day}일`};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const ThreadList=props=>{const{containerRef,size="md",onClickImage,isShowScrollBottomButton=!1}=props,{teamPlaceId}=(0,useTeamPlace.l)(),{threadPages,hasNextPage,fetchNextPage}=useFetchThreads(teamPlaceId),threadEndRef=(0,react.useRef)(null),observeRef=(0,react.useRef)(null),[scrollHeight,setScrollHeight]=(0,react.useState)(0),{firstDate,setFirstDateTime}=(()=>{const[firstDateTime,setFirstDateTime]=(0,react.useState)(void 0),splittedFirstDateTime=firstDateTime?splitDateTime(firstDateTime):void 0;return{firstDate:splittedFirstDateTime?.date,firstTime:splittedFirstDateTime?.time,setFirstDateTime}})();return((targetRef,onIntersect,hasNextPage)=>{const observer=(0,react.useRef)();(0,react.useEffect)((()=>{if(targetRef&&targetRef.current){if(observer.current=new IntersectionObserver(onIntersect,{root:null,rootMargin:"0px",threshold:1}),!hasNextPage)return void observer.current?.unobserve(targetRef.current);observer.current.observe(targetRef.current)}return()=>observer&&observer.current?.disconnect()}),[targetRef,onIntersect])})(observeRef,(([entry])=>{entry.isIntersecting&&teamPlaceId>0&&fetchNextPage()}),hasNextPage),(0,react.useEffect)((()=>{const containerElement=containerRef?.current;if(!containerElement)return;const scrollTop=containerElement.scrollHeight-scrollHeight;if(containerElement.scrollTop=scrollTop,setScrollHeight((()=>containerElement.scrollHeight)),threadPages){const newFirstDateTime=threadPages.pages.at(-1)?.threads.at(-1)?.createdAt;setFirstDateTime((()=>newFirstDateTime))}}),[threadPages?.pages.length]),(0,react.useEffect)((()=>{threadEndRef.current&&threadEndRef.current.scrollIntoView()}),[teamPlaceId]),(0,react.useEffect)((()=>{threadEndRef.current&&(isShowScrollBottomButton||threadEndRef.current.scrollIntoView())}),[threadPages?.pages[0].threads.length]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{ref:observeRef}),!hasNextPage&&threadPages&&threadPages.pages[0].threads.length>0&&(0,jsx_runtime.jsx)(Text.Z,{size:"lg",css:lastThreadText,children:"마지막 채팅 입니다."}),threadPages?.pages.slice().reverse().map((page=>page.threads.slice().reverse().map(((thread,index,threads)=>{const{id,type,profileImageUrl,content,authorId,createdAt,...rest}=thread,previousThread=threads[index-1],currentDateTime=splitDateTime(createdAt),previousDateTime=previousThread?splitDateTime(previousThread.createdAt):null,isFirstThreadOfDay=((currentDate,firstDate,previousDate)=>previousDate?currentDate!==previousDate:!firstDate||currentDate!==firstDate)(currentDateTime.date,firstDate,previousDateTime?.date),isContinue=index-1>=0&&authorId===previousThread.authorId&&!isFirstThreadOfDay;return type===feed.KD.THREAD?(0,jsx_runtime.jsxs)(react.Fragment,{children:[isFirstThreadOfDay&&(0,jsx_runtime.jsx)(Notification.Z,{type:"date",content:formatDate(currentDateTime.date),size}),(0,jsx_runtime.jsx)(Thread.Z,{threadSize:size,profileImageUrl,createdAt,content,isContinue,onClickImage,...rest})]},id):(0,jsx_runtime.jsxs)(react.Fragment,{children:[isFirstThreadOfDay&&(0,jsx_runtime.jsx)(Notification.Z,{type:"date",content:formatDate(currentDateTime.date),size}),(0,jsx_runtime.jsx)(Notification.Z,{type:"date",content,time:currentDateTime.time,size})]},id)})))),(0,jsx_runtime.jsx)("div",{ref:threadEndRef}),threadPages&&0===threadPages.pages[0].threads.length&&(0,jsx_runtime.jsx)(EmptyFeedPlaceholder.Z,{})]})},ThreadList_ThreadList=ThreadList;try{ThreadList.displayName="ThreadList",ThreadList.__docgenInfo={description:"",displayName:"ThreadList",props:{containerRef:{defaultValue:null,description:"",name:"containerRef",required:!1,type:{name:"RefObject<HTMLDivElement>"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'}]}},onClickImage:{defaultValue:null,description:"",name:"onClickImage",required:!0,type:{name:"(images: ThreadImage[], selectedImage: number) => void"}},isShowScrollBottomButton:{defaultValue:null,description:"",name:"isShowScrollBottomButton",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/feed/ThreadList/ThreadList.tsx#ThreadList"]={docgenInfo:ThreadList.__docgenInfo,name:"ThreadList",path:"src/components/feed/ThreadList/ThreadList.tsx#ThreadList"})}catch(__react_docgen_typescript_loader_error){}const ThreadList_stories={title:"Feed/ThreadList",component:ThreadList_ThreadList,tags:["autodocs"]},Default={args:{}};Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: {}\n}",...Default.parameters?.docs?.source}}};const __namedExportsOrder=["Default"]},"./src/components/feed/EmptyFeedPlaceholder/EmptyFeedPlaceholder.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>EmptyFeedPlaceholder_EmptyFeedPlaceholder});var Text=__webpack_require__("./src/components/common/Text/Text.tsx"),png=__webpack_require__("./src/assets/png/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js");const Container=styled_components_browser_esm.zo.div`
  display: flex;
  justify-content: center;
  align-items: center;

  width: 100%;
  height: 100%;
`,PlaceholderContainer=styled_components_browser_esm.zo.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  row-gap: 18px;

  width: 380px;
`,FeedEmptyImage=styled_components_browser_esm.zo.img`
  width: 18%;
  margin-bottom: 10px;
`,titleText=styled_components_browser_esm.iv`
  font-size: 28px;
  color: ${({theme})=>theme.color.GRAY400};
`;styled_components_browser_esm.iv`
  font-size: 20px;
  color: ${({theme})=>theme.color.GRAY500};
`;var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const EmptyFeedPlaceholder=()=>(0,jsx_runtime.jsx)(Container,{children:(0,jsx_runtime.jsxs)(PlaceholderContainer,{children:[(0,jsx_runtime.jsx)(FeedEmptyImage,{src:png.WG,alt:"비어있는 피드 이미지"}),(0,jsx_runtime.jsx)(Text.Z,{weight:"bold",css:titleText,children:"대화를 시작해 보세요!"})]})});EmptyFeedPlaceholder.displayName="EmptyFeedPlaceholder";const EmptyFeedPlaceholder_EmptyFeedPlaceholder=EmptyFeedPlaceholder},"./src/components/feed/Notification/Notification.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Notification_Notification});var Text=__webpack_require__("./src/components/common/Text/Text.tsx"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js");const Container=styled_components_browser_esm.zo.div`
  display: flex;
  justify-content: center;
  gap: 16px;

  width: 100%;
  height: 30px;
`,Line=styled_components_browser_esm.zo.div`
  flex-grow: 1;

  min-width: 8%;
  margin: auto;
  border-top: 1px solid ${({theme})=>theme.color.BLUE300};
`,Inner=styled_components_browser_esm.zo.div`
  display: flex;
  justify-content: center;
  align-items: center;
  column-gap: 8px;

  max-width: 80%;
`,IconWrapper=styled_components_browser_esm.zo.div`
  width: ${({$size})=>"md"===$size?"24px":"20px"};
  height: ${({$size})=>"md"===$size?"24px":"20px"};

  & svg {
    width: ${({$size})=>"md"===$size?"24px":"20px"};
    height: ${({$size})=>"md"===$size?"24px":"20px"};

    color: ${({theme})=>theme.color.BLUE500};
    fill: ${({theme})=>theme.color.BLUE500};
  }
`,Notification_styled_content=styled_components_browser_esm.iv`
  overflow: hidden;

  text-overflow: ellipsis;
  white-space: nowrap;
`,Notification_styled_time=styled_components_browser_esm.iv`
  display: block;

  color: ${({theme})=>theme.color.BLUE500};
`;var svg=__webpack_require__("./src/assets/svg/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Notification=props=>{const{content,type,time,size="md"}=props;return(0,jsx_runtime.jsxs)(Container,{children:[(0,jsx_runtime.jsx)(Line,{}),(0,jsx_runtime.jsxs)(Inner,{children:["normal"!==type&&(0,jsx_runtime.jsx)(IconWrapper,{$size:size,children:"join"===type?(0,jsx_runtime.jsx)(svg.m5,{}):"leave"===type?(0,jsx_runtime.jsx)(svg.iz,{}):(0,jsx_runtime.jsx)(svg.Qu,{})}),(0,jsx_runtime.jsx)(Text.Z,{size:"md"===size?"md":"sm",css:Notification_styled_content,children:content}),time&&(0,jsx_runtime.jsx)(Text.Z,{size:"md"===size?"xs":"xxs",css:Notification_styled_time,children:time})]}),(0,jsx_runtime.jsx)(Line,{})]})};Notification.displayName="Notification";const Notification_Notification=Notification;try{Notification.displayName="Notification",Notification.__docgenInfo={description:"",displayName:"Notification",props:{content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"join"'},{value:'"normal"'},{value:'"leave"'},{value:'"date"'}]}},time:{defaultValue:null,description:"",name:"time",required:!1,type:{name:"string"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/feed/Notification/Notification.tsx#Notification"]={docgenInfo:Notification.__docgenInfo,name:"Notification",path:"src/components/feed/Notification/Notification.tsx#Notification"})}catch(__react_docgen_typescript_loader_error){}},"./src/constants/query.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{i:()=>STALE_TIME});const STALE_TIME={SCHEDULES:3e4,DAILY_SCHEDULES:3e4,MY_SCHEDULES:3e4,MY_DAILY_SCHEDULES:3e4,USER_INFO:3e5,TEAM_PLACE_MEMBERS:6e4,TEAM_PLACE_INVITE_CODE:1/0,TEAM_LINKS:6e4,TEAM_FEED:3e5,ICALENDAR_URL:1/0}},"./src/hooks/useTeamPlace.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>useTeamPlace});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_contexts_TeamPlaceContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/contexts/TeamPlaceContext.tsx");const useTeamPlace=()=>{const context=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_contexts_TeamPlaceContext__WEBPACK_IMPORTED_MODULE_1__.Q);if(void 0===context)throw new Error("useTeamPlace must be used within a TeamPlaceContext");return context}},"./src/types/typeGuard.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>isYYYYMMDD,r:()=>isYYYYMMDDHHMM});const isYYYYMMDDHHMM=value=>"string"==typeof value&&/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(value),isYYYYMMDD=value=>"string"==typeof value&&/^\d{4}-\d{2}-\d{2}$/.test(value)}}]);
//# sourceMappingURL=components-feed-ThreadList-ThreadList-stories.4fd41cb7.iframe.bundle.js.map